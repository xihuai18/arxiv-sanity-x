"use strict";(()=>{var z=Object.defineProperty,G=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var k=(c,i,s)=>i in c?z(c,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[i]=s,A=(c,i)=>{for(var s in i||(i={}))V.call(i,s)&&k(c,s,i[s]);if(E)for(var s of E(i))X.call(i,s)&&k(c,s,i[s]);return c},P=(c,i)=>G(c,K(i));var Y=(c,i)=>()=>(i||c((i={exports:{}}).exports,i),i.exports);var Q=Y(T=>{(function(c){const i="ArxivSanityCommon";function s(){const e=document.querySelector('meta[name="csrf-token"]');return e&&e.getAttribute("content")||""}function _(e,t){const o=t||{},n=(o.method||"POST").toUpperCase(),r=new Headers(o.headers||{}),f=s();return f&&r.set("X-CSRF-Token",f),n!=="GET"&&!r.has("Content-Type")&&o.body&&r.set("Content-Type","application/json"),fetch(e,P(A({},o),{method:n,headers:r,credentials:"same-origin"}))}const U="arxiv-sanity-user-events";let u=null,l=null,a=null,m=[];function C(){return u||(typeof BroadcastChannel!="undefined"&&(u=new BroadcastChannel(U)),u)}function y(){return fetch("/api/user_state",{credentials:"same-origin"}).then(e=>e.json()).catch(()=>null)}function S(){l&&(clearInterval(l),l=null)}function p(e){l||(l=setInterval(()=>{y().then(t=>{e&&e(t)})},15e3))}function $(e){typeof e=="function"&&!m.includes(e)&&m.push(e)}function M(e){const t=m.indexOf(e);t>=0&&m.splice(t,1)}function g(e,t){if(!e||typeof e!="object")return;const o=t||{};!o.fromBroadcast&&u&&u.postMessage(e),m.forEach(n=>{try{n(e,o)}catch(r){console.warn("Event handler error:",r)}})}function F(e,t){if(!e)return;const o=C();if(o&&(o.onmessage=r=>{g(r.data||{},{fromBroadcast:!0})}),typeof EventSource=="undefined"){p(t);return}const n=()=>{a=new EventSource("/api/user_stream"),a.onopen=()=>{S()},a.onmessage=r=>{if(!(!r||!r.data))try{const f=JSON.parse(r.data);g(f)}catch(f){console.warn("Failed to parse user event:",f)}},a.onerror=()=>{a&&(a.close(),a=null),p(t),setTimeout(n,8e3)}};n()}const w=new Map;let v=!1;function L(){v||(v=!0,document.addEventListener("mousedown",e=>{w.forEach((t,o)=>{if(!t||!t.isOpen||!t.isOpen())return;const n=document.getElementById(o);n&&!n.contains(e.target)&&t.close()})}),document.addEventListener("keydown",e=>{e.key==="Escape"&&w.forEach(t=>{t&&t.isOpen&&t.isOpen()&&t.close()})}))}function b(e,t){w.set(e,t),L()}function J(e){w.delete(e)}function N(e,t){const o=t||"API",n=e&&e.message?e.message:String(e||"Unknown error");return console.error(`[${o}]`,e),n.includes("Failed to fetch")||n.includes("NetworkError")?"Network error. Please check your connection and try again.":n.includes("timeout")||n.includes("Timeout")?"Request timeout. The operation is taking longer than expected.":n.includes("401")||n.includes("Unauthorized")?"Authentication required. Please log in again.":n.includes("403")||n.includes("Forbidden")?"Access denied. You do not have permission for this operation.":n.includes("404")||n.includes("Not Found")?"Resource not found.":n.includes("500")||n.includes("Internal Server Error")?"Server error. Please try again later.":n}function R(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function B(e){try{const t=new URL(String(e||""),window.location.href);return t.protocol==="http:"||t.protocol==="https:"||t.protocol==="mailto:"}catch(t){return!1}}function d(e,t,o){if(o==null)return;const n=String(o).trim();n&&e.set(t,n)}function h(e,t,o){const n=t||{},r=o||window.gvars;r&&(d(e,"time_filter",r.time_filter),r.skip_have&&e.set("skip_have",r.skip_have),n.includeLogic&&r.logic&&e.set("logic",r.logic),n.includeSvmC&&d(e,"svm_c",r.svm_c),n.includeSearchMode&&r.search_mode&&e.set("search_mode",r.search_mode),n.includeSemanticWeight&&d(e,"semantic_weight",r.semantic_weight))}function O(e,t){const o=t||{},n=new URLSearchParams;return n.set("rank","tags"),d(n,"tags",e),h(n,{includeLogic:!0,includeSvmC:!0},o.gvars),o.logic&&n.set("logic",o.logic),"/?"+n.toString()}function H(e,t){const o=t||{},n=new URLSearchParams;return n.set("rank","search"),d(n,"q",e),h(n,{includeSearchMode:!0,includeSemanticWeight:!0},o.gvars),"/?"+n.toString()}function q(e,t){return typeof window!="undefined"&&window.ArxivSanityAuthors&&window.ArxivSanityAuthors.format?window.ArxivSanityAuthors.format(e,t).text:String(e||"")}function I(e){return typeof window!="undefined"&&window.ArxivSanityTldr&&window.ArxivSanityTldr.render?window.ArxivSanityTldr.render(e):e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"):""}function D(e){if(typeof window!="undefined"&&window.ArxivSanityTldr&&window.ArxivSanityTldr.triggerMathJax)return window.ArxivSanityTldr.triggerMathJax(e);typeof MathJax!="undefined"&&MathJax.typesetPromise&&MathJax.typesetPromise(e?[e]:void 0).catch(function(t){console.warn("MathJax typeset error:",t)})}const x=typeof window!="undefined"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1");function j(e,t){if(!x||typeof performance=="undefined")return t();const o=performance.now();try{const n=t(),r=performance.now()-o;return r>100?console.warn(`\u26A0\uFE0F Performance: ${e} took ${r.toFixed(2)}ms`):r>10&&console.log(`\u23F1\uFE0F Performance: ${e} took ${r.toFixed(2)}ms`),n}catch(n){const r=performance.now()-o;throw console.error(`\u274C Performance: ${e} failed after ${r.toFixed(2)}ms`,n),n}}async function W(e,t){if(!x||typeof performance=="undefined")return await t();const o=performance.now();try{const n=await t(),r=performance.now()-o;return r>100?console.warn(`\u26A0\uFE0F Performance: ${e} took ${r.toFixed(2)}ms`):r>10&&console.log(`\u23F1\uFE0F Performance: ${e} took ${r.toFixed(2)}ms`),n}catch(n){const r=performance.now()-o;throw console.error(`\u274C Performance: ${e} failed after ${r.toFixed(2)}ms`,n),n}}c[i]={getCsrfToken:s,csrfFetch:_,fetchUserState:y,setupUserEventStream:F,registerEventHandler:$,unregisterEventHandler:M,dispatchUserEvent:g,stopUserStatePolling:S,startUserStatePolling:p,registerDropdown:b,unregisterDropdown:J,handleApiError:N,measurePerformance:j,measurePerformanceAsync:W,escapeHtml:R,isSafeUrl:B,appendParam:d,appendCommonFilters:h,buildTagUrl:O,buildKeywordUrl:H,formatAuthorsText:q,renderTldrMarkdown:I,triggerMathJax:D}})(typeof window!="undefined"?window:T)});Q();})();
