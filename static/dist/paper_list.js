"use strict";(()=>{var z=Object.defineProperty,G=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var S=(t,e,a)=>e in t?z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,u=(t,e)=>{for(var a in e||(e={}))H.call(e,a)&&S(t,a,e[a]);if(M)for(var a of M(e))X.call(e,a)&&S(t,a,e[a]);return t},C=(t,e)=>G(t,q(e));function J(){const t=document.querySelector('meta[name="csrf-token"]');return t&&t.getAttribute("content")||""}function r(t,e){const a=e||{},n=(a.method||"POST").toUpperCase(),o=new Headers(a.headers||{}),d=J();return d&&o.set("X-CSRF-Token",d),fetch(t,C(u({},a),{method:n,headers:o,credentials:"same-origin"}))}function b(t,e,a){if(a==null)return;const n=String(a).trim();n&&t.set(e,n)}function I(t,e={}){typeof gvars=="undefined"||!gvars||(b(t,"time_filter",gvars.time_filter),gvars.skip_have&&t.set("skip_have",gvars.skip_have),e.includeLogic&&gvars.logic&&t.set("logic",gvars.logic),e.includeSvmC&&b(t,"svm_c",gvars.svm_c),e.includeSearchMode&&gvars.search_mode&&t.set("search_mode",gvars.search_mode),e.includeSemanticWeight&&b(t,"semantic_weight",gvars.semantic_weight))}function x(t,e={}){const a=new URLSearchParams;return a.set("rank","tags"),b(a,"tags",t),I(a,{includeLogic:!0,includeSvmC:!0}),e.logic&&a.set("logic",e.logic),"/?"+a.toString()}function Q(t){const e=new URLSearchParams;return e.set("rank","search"),b(e,"q",t),I(e,{includeSearchMode:!0,includeSemanticWeight:!0}),"/?"+e.toString()}const y=new Map;let K=!1;function Y(){K||(K=!0,document.addEventListener("mousedown",t=>{y.forEach((e,a)=>{if(!e.isOpen())return;const n=document.getElementById(a);n&&!n.contains(t.target)&&e.close()})}),document.addEventListener("keydown",t=>{t.key==="Escape"&&y.forEach(e=>{e.isOpen()&&e.close()})}))}function Z(t,e){y.set(t,e),Y()}function ee(t){y.delete(t)}const O=t=>{const{selectedTags:e,availableTags:a,isOpen:n,onToggle:o,onTagToggle:d,onRemoveTag:i,newTagValue:s,onNewTagChange:h,onAddNewTag:c,dropdownId:g,searchValue:p,onSearchChange:U,showNewTagInput:P=!0}=t,W=e.map((l,k)=>React.createElement("div",{key:k,class:"multi-select-selected-tag"},React.createElement("span",null,l),React.createElement("span",{class:"remove-tag",onClick:()=>i(l)},"\xD7"))),B=e.length>0?React.createElement("div",{class:"multi-select-selected-tags"},W):React.createElement("div",{class:"multi-select-placeholder"},"Select tags..."),j=a.filter(l=>l.toLowerCase().includes(p.toLowerCase())).map((l,k)=>{const $=e.includes(l);return React.createElement("div",{key:k,class:"multi-select-option",onClick:()=>d(l)},React.createElement("input",{type:"checkbox",class:"multi-select-checkbox",checked:$,onChange:()=>{}}),React.createElement("span",{class:"multi-select-option-text"},l))});return React.createElement("div",{class:`multi-select-dropdown ${n?"open":""}`,id:g},React.createElement("div",{class:`multi-select-trigger ${n?"active":""}`,onClick:o},React.createElement("div",{class:"multi-select-content"},B),React.createElement("span",{class:"multi-select-arrow"},n?"\u25B2":"\u25BC")),n&&React.createElement("div",{class:"multi-select-dropdown-menu"},React.createElement("div",{class:"multi-select-search"},React.createElement("input",{type:"text",placeholder:"Search tags...",value:p,onChange:U,onClick:l=>l.stopPropagation()})),j,P&&React.createElement("div",{class:"multi-select-new-tag"},React.createElement("input",{type:"text",placeholder:"Enter new tag...",value:s,onChange:h,onKeyPress:l=>l.key==="Enter"&&c(),onClick:l=>l.stopPropagation()}),React.createElement("button",{onClick:c,disabled:!s.trim()},"Add"))))},te=t=>{const e=t.paper,n=t.tags.map((g,p)=>g.name),o=e.utags,d="/?rank=pid&pid="+encodeURIComponent(e.id),i="/inspect?pid="+encodeURIComponent(e.id),s="/summary?pid="+encodeURIComponent(e.id),h=e.thumb_url===""?null:React.createElement("div",{class:"rel_img"},React.createElement("img",{src:e.thumb_url}));let c=null;return user&&(c=React.createElement("div",{class:"rel_utags"},React.createElement(O,{selectedTags:o,availableTags:n,isOpen:t.dropdownOpen,onToggle:t.onToggleDropdown,onTagToggle:t.onTagToggle,onRemoveTag:t.onRemoveTag,newTagValue:t.newTagValue,onNewTagChange:t.onNewTagChange,onAddNewTag:t.onAddNewTag,dropdownId:t.dropdownId,searchValue:t.searchValue,onSearchChange:t.onSearchChange}))),React.createElement("div",{class:"rel_paper"},React.createElement("div",{class:"rel_score"},e.weight.toFixed(2),e.score_breakdown&&React.createElement("div",{class:"score_breakdown"},e.score_breakdown)),React.createElement("div",{class:"rel_title"},React.createElement("a",{href:"http://arxiv.org/abs/"+e.id,target:"_blank",rel:"noopener noreferrer"},e.title)),React.createElement("div",{class:"rel_authors"},e.authors),React.createElement("div",{class:"rel_time"},e.time),React.createElement("div",{class:"rel_tags"},e.tags),h,React.createElement("div",{class:"rel_abs"},e.summary),c,React.createElement("div",{class:"paper-actions-footer"},React.createElement("div",{class:"rel_more"},React.createElement("a",{href:d,target:"_blank",rel:"noopener noreferrer"},"Similar")),React.createElement("div",{class:"rel_inspect"},React.createElement("a",{href:i,target:"_blank",rel:"noopener noreferrer"},"Inspect")),React.createElement("div",{class:"rel_summary"},React.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},"Summary")),React.createElement("div",{class:"rel_alphaxiv"},React.createElement("a",{href:"https://www.alphaxiv.org/overview/"+e.id,target:"_blank",rel:"noopener noreferrer"},"alphaXiv")),React.createElement("div",{class:"rel_cool"},React.createElement("a",{href:"https://papers.cool/arxiv/"+e.id,target:"_blank",rel:"noopener noreferrer"},"Cool"))))},ae=t=>{const e=t.papers,a=t.tags.filter(o=>o.name!=="all"),n=e.map((o,d)=>React.createElement(ne,{key:d,paper:o,tags:a}));return React.createElement("div",null,React.createElement("div",{id:"paperList",class:"rel_papers"},n))};class ne extends React.Component{constructor(e){super(e),this.state={paper:e.paper,tags:e.tags,dropdownOpen:!1,newTagValue:"",searchValue:""},this.dropdownId="dropdown-"+e.paper.id,this.handleToggleDropdown=this.handleToggleDropdown.bind(this),this.handleTagToggle=this.handleTagToggle.bind(this),this.handleRemoveTag=this.handleRemoveTag.bind(this),this.handleNewTagChange=this.handleNewTagChange.bind(this),this.handleAddNewTag=this.handleAddNewTag.bind(this),this.handleSearchChange=this.handleSearchChange.bind(this)}componentDidMount(){Z(this.dropdownId,{isOpen:()=>this.state.dropdownOpen,close:()=>{const e=document.getElementById(this.dropdownId);if(e){const a=e.closest(".rel_paper");a&&a.classList.remove("dropdown-open")}this.setState({dropdownOpen:!1})}})}componentWillUnmount(){ee(this.dropdownId)}handleToggleDropdown(){this.setState(e=>{const a=!e.dropdownOpen,n=document.getElementById(this.dropdownId);if(n){const o=n.closest(".rel_paper");o&&(a?o.classList.add("dropdown-open"):o.classList.remove("dropdown-open"))}return{dropdownOpen:a,searchValue:a?"":e.searchValue}})}handleSearchChange(e){this.setState({searchValue:e.target.value})}handleTagToggle(e){const{paper:a}=this.state;a.utags.includes(e)?r("/sub/"+a.id+"/"+encodeURIComponent(e)).then(o=>o.text()).then(o=>{o.startsWith("ok")?(a.utags=a.utags.filter(d=>d!==e),this.setState({paper:a}),v(e,-1),console.log(`Removed tag: ${e}`)):(console.error("Server error removing tag:",o),alert("Failed to remove tag: "+o))}).catch(o=>{console.error("Error removing tag:",o),alert("Network error, failed to remove tag")}):r("/add/"+a.id+"/"+encodeURIComponent(e)).then(o=>o.text()).then(o=>{o.startsWith("ok")?(a.utags.includes(e)||(a.utags=[...a.utags,e]),this.setState({paper:a}),v(e,1),console.log(`Added tag: ${e}`)):(console.error("Server error adding tag:",o),alert("Failed to add tag: "+o))}).catch(o=>{console.error("Error adding tag:",o),alert("Network error, failed to add tag")})}handleRemoveTag(e){const{paper:a}=this.state;r("/sub/"+a.id+"/"+encodeURIComponent(e)).then(n=>n.text()).then(n=>{n.startsWith("ok")?(a.utags=a.utags.filter(o=>o!==e),this.setState({paper:a}),v(e,-1),console.log(`Removed tag: ${e}`)):(console.error("Server error removing tag:",n),alert("Failed to remove tag: "+n))}).catch(n=>{console.error("Error removing tag:",n),alert("Network error, failed to remove tag")})}handleNewTagChange(e){this.setState({newTagValue:e.target.value})}handleAddNewTag(){const{paper:e,newTagValue:a}=this.state,n=a.trim();if(n){if(e.utags.includes(n)){alert("Tag already exists");return}r("/add/"+e.id+"/"+encodeURIComponent(n)).then(o=>o.text()).then(o=>{o.startsWith("ok")?(e.utags=[...e.utags,n],this.setState({paper:e,newTagValue:""}),v(n,1),console.log(`Added new tag: ${n}`)):(console.error("Server error adding new tag:",o),alert("Failed to add new tag: "+o))}).catch(o=>{console.error("Error adding new tag:",o),alert("Network error, failed to add new tag")})}}render(){return React.createElement(te,{paper:this.state.paper,tags:this.state.tags,dropdownOpen:this.state.dropdownOpen,onToggleDropdown:this.handleToggleDropdown,onTagToggle:this.handleTagToggle,onRemoveTag:this.handleRemoveTag,newTagValue:this.state.newTagValue,onNewTagChange:this.handleNewTagChange,onAddNewTag:this.handleAddNewTag,dropdownId:this.dropdownId,searchValue:this.state.searchValue,onSearchChange:this.handleSearchChange})}}const oe=t=>{const e=t.tag,a=x(e.name),n="rel_utag"+(e.name==="all"?" rel_utag_all":""),o=e.name!=="all";return React.createElement("div",{class:n+" enhanced-tag"},React.createElement("a",{href:a,class:"tag-link"},e.n," ",e.name),o&&React.createElement("div",{class:"tag-actions"},React.createElement("span",{class:"tag-edit",onClick:()=>t.onEdit(e),title:"Edit tag"},"\u270E"),React.createElement("span",{class:"tag-delete",onClick:()=>t.onDelete(e),title:"Delete tag"},"\xD7")))},de=t=>{const e=t.tags,a=e.map((d,i)=>React.createElement(oe,{key:i,tag:d,onEdit:t.onEditTag,onDelete:t.onDeleteTag})),n=()=>{const d=document.getElementById("wordwrap");d.style.display==="block"?d.style.display="none":d.style.display="block"},o=words.length>0?React.createElement("div",{id:"inspect_svm",onClick:n},"inspect"):null;return React.createElement("div",{class:"enhanced-tag-list"},React.createElement("div",{class:"tag-list-actions"},React.createElement("span",{class:"tag-stats-inline"},"(",e.length," tags)"),React.createElement("button",{class:"tag-action-btn add-btn",onClick:t.onAddTag,title:"Add new tag"},"+ Add")),React.createElement("div",{id:"tagList",class:"rel_utags enhanced-tags"},a),o,t.showEditModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseEditModal},React.createElement("div",{class:"modal-content",onClick:d=>d.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Edit Tag"),React.createElement("span",{class:"modal-close",onClick:t.onCloseEditModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("div",{class:"form-group"},React.createElement("label",null,"Tag Name:"),React.createElement("input",{type:"text",value:t.editingTagName,onChange:t.onEditingTagNameChange,class:"form-input",placeholder:"Enter new tag name"}))),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseEditModal},"Cancel"),React.createElement("button",{class:"btn btn-primary",onClick:t.onSaveTagEdit},"Save")))),t.showAddModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseAddModal},React.createElement("div",{class:"modal-content",onClick:d=>d.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Add Tag"),React.createElement("span",{class:"modal-close",onClick:t.onCloseAddModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("div",{class:"form-group"},React.createElement("label",null,"Tag Name:"),React.createElement("input",{type:"text",value:t.newTagName,onChange:t.onNewTagNameChange,class:"form-input",placeholder:"Enter tag name"}))),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseAddModal},"Cancel"),React.createElement("button",{class:"btn btn-primary",onClick:t.onSaveNewTag},"Save")))),t.showDeleteModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseDeleteModal},React.createElement("div",{class:"modal-content",onClick:d=>d.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Confirm Delete"),React.createElement("span",{class:"modal-close",onClick:t.onCloseDeleteModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("p",null,'Are you sure you want to delete tag "',React.createElement("strong",null,t.deletingTag&&t.deletingTag.name),'"?'),React.createElement("p",{class:"warning-text"},"This action is irreversible. All papers under this tag will lose the tag.")),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseDeleteModal},"Cancel"),React.createElement("button",{class:"btn btn-danger",onClick:t.onConfirmDelete},"Delete")))))};class ie extends React.Component{constructor(e){super(e),this.state={tags:e.tags,showEditModal:!1,showDeleteModal:!1,showAddModal:!1,editingTag:null,editingTagName:"",deletingTag:null,newTagName:""},this.handleEditTag=this.handleEditTag.bind(this),this.handleDeleteTag=this.handleDeleteTag.bind(this),this.handleAddTag=this.handleAddTag.bind(this),this.handleCloseEditModal=this.handleCloseEditModal.bind(this),this.handleCloseDeleteModal=this.handleCloseDeleteModal.bind(this),this.handleCloseAddModal=this.handleCloseAddModal.bind(this),this.handleEditingTagNameChange=this.handleEditingTagNameChange.bind(this),this.handleNewTagNameChange=this.handleNewTagNameChange.bind(this),this.handleSaveTagEdit=this.handleSaveTagEdit.bind(this),this.handleSaveNewTag=this.handleSaveNewTag.bind(this),this.handleConfirmDelete=this.handleConfirmDelete.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}handleKeyDown(e){e.key==="Escape"&&(this.state.showEditModal&&this.handleCloseEditModal(),this.state.showDeleteModal&&this.handleCloseDeleteModal(),this.state.showAddModal&&this.handleCloseAddModal())}handleEditTag(e){this.setState({showEditModal:!0,editingTag:e,editingTagName:e.name})}handleDeleteTag(e){this.setState({showDeleteModal:!0,deletingTag:e})}handleAddTag(){this.setState({showAddModal:!0,newTagName:""})}handleCloseAddModal(){this.setState({showAddModal:!1,newTagName:""})}handleNewTagNameChange(e){this.setState({newTagName:e.target.value})}handleSaveNewTag(){const{newTagName:e}=this.state,a=e.trim();if(!a){alert("Tag name cannot be empty");return}if(a==="all"||a==="null"){alert("Tag name is reserved");return}if(this.state.tags.some(n=>n.name===a)){alert("Tag already exists");return}r("/add_tag/"+encodeURIComponent(a)).then(n=>n.text()).then(n=>{n.startsWith("ok")?(this.setState(o=>{const d=T(o.tags.filter(i=>i.name!=="all").concat([{name:a,n:0}]));return f(d,{renderTags:!1}),{tags:d,showAddModal:!1,newTagName:""}}),console.log("Tag added successfully")):alert("Add failed: "+n)}).catch(n=>{console.error("Error adding tag:",n),alert("Network error, add failed")})}handleCloseEditModal(){this.setState({showEditModal:!1,editingTag:null,editingTagName:""})}handleCloseDeleteModal(){this.setState({showDeleteModal:!1,deletingTag:null})}handleEditingTagNameChange(e){this.setState({editingTagName:e.target.value})}handleSaveTagEdit(){const{editingTag:e,editingTagName:a}=this.state;if(!a.trim()){alert("Tag name cannot be empty");return}const n=a.trim();if(this.state.tags.some(o=>o.name===n&&o.name!==e.name)){alert("Tag already exists");return}r("/rename/"+encodeURIComponent(e.name)+"/"+encodeURIComponent(n)).then(o=>o.text()).then(o=>{o.startsWith("ok")?(this.setState(d=>{const i=T(d.tags.map(h=>h.name===e.name?C(u({},h),{name:n}):h)),s=me(combined_tags,e.name,n);return w(s,{renderCombined:!1}),f(i,{renderTags:!1}),{tags:i,showEditModal:!1,editingTag:null,editingTagName:""}}),console.log("Tag renamed successfully")):alert("Rename failed: "+o)}).catch(o=>{console.error("Error renaming tag:",o),alert("Network error, rename failed")})}handleConfirmDelete(){const{deletingTag:e}=this.state;r("/del/"+encodeURIComponent(e.name)).then(a=>a.text()).then(a=>{a.startsWith("ok")?(this.setState(n=>{const o=T(n.tags.filter(i=>i.name!==e.name)),d=ue(combined_tags,e.name);return w(d,{renderCombined:!1}),f(o,{renderTags:!1}),{tags:o,showDeleteModal:!1,deletingTag:null}}),console.log("Tag deleted successfully")):alert("Delete failed: "+a)}).catch(a=>{console.error("Error deleting tag:",a),alert("Network error, delete failed")})}render(){return React.createElement(de,{tags:this.state.tags,onEditTag:this.handleEditTag,onDeleteTag:this.handleDeleteTag,onAddTag:this.handleAddTag,showEditModal:this.state.showEditModal,showDeleteModal:this.state.showDeleteModal,showAddModal:this.state.showAddModal,editingTagName:this.state.editingTagName,newTagName:this.state.newTagName,deletingTag:this.state.deletingTag,onCloseEditModal:this.handleCloseEditModal,onCloseDeleteModal:this.handleCloseDeleteModal,onCloseAddModal:this.handleCloseAddModal,onEditingTagNameChange:this.handleEditingTagNameChange,onNewTagNameChange:this.handleNewTagNameChange,onSaveTagEdit:this.handleSaveTagEdit,onSaveNewTag:this.handleSaveNewTag,onConfirmDelete:this.handleConfirmDelete})}}const se=t=>{const e=t.comtag,a=x(e.name,{logic:"and"});return React.createElement("div",{class:"rel_utag rel_utag_all enhanced-combined-tag"},React.createElement("a",{href:a,class:"combined-tag-link"},e.name),React.createElement("div",{class:"combined-tag-actions"},React.createElement("span",{class:"combined-tag-edit",onClick:()=>t.onEdit(e),title:"Edit combined tag"},"\u270E"),React.createElement("span",{class:"combined-tag-delete",onClick:()=>t.onDelete(e),title:"Delete combined tag"},"\xD7")))},le=t=>{const e=t.combined_tags,a=e.map((n,o)=>React.createElement(se,{key:o,comtag:n,onEdit:t.onEditCombinedTag,onDelete:t.onDeleteCombinedTag}));return React.createElement("div",{class:"enhanced-combined-tag-list"},React.createElement("div",{class:"combined-tag-list-actions"},React.createElement("span",{class:"tag-stats-inline"},"(",e.length," combined tags)"),React.createElement("button",{class:"tag-action-btn add-btn",onClick:t.onAddCombinedTag,title:"Add new combined tag"},"+ Add")),React.createElement("div",{id:"combinedTagList",class:"rel_utags enhanced-combined-tags"},a),t.showAddEditModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseAddEditModal},React.createElement("div",{class:"modal-content wide",onClick:n=>n.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,t.editingCombinedTag?"Edit Combined Tag":"Add Combined Tag"),React.createElement("span",{class:"modal-close",onClick:t.onCloseAddEditModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("div",{class:"form-group"},React.createElement("label",null,"Select tags to combine:"),React.createElement(O,{selectedTags:t.selectedTagsForCombination,availableTags:t.availableTagsForCombination,isOpen:t.combinationDropdownOpen,onToggle:t.onToggleCombinationDropdown,onTagToggle:t.onCombinationTagToggle,onRemoveTag:t.onRemoveCombinationTag,newTagValue:"",onNewTagChange:()=>{},onAddNewTag:()=>{},dropdownId:"combination-dropdown",searchValue:t.combinationSearchValue,onSearchChange:t.onCombinationSearchChange,showNewTagInput:!1})),t.selectedTagsForCombination.length>0&&React.createElement("div",{class:"tag-combination-preview"},React.createElement("h4",null,"Preview Combination:"),React.createElement("div",{class:"tag-combination-preview-tags"},t.selectedTagsForCombination.map((n,o)=>React.createElement("span",{key:o,class:"tag-combination-preview-tag"},n))),React.createElement("p",{style:{marginTop:"10px",fontSize:"12px",color:"var(--text-color)",opacity:"0.8"}},"Combination Name: ",t.selectedTagsForCombination.join(", ")))),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseAddEditModal},"Cancel"),React.createElement("button",{class:"btn btn-primary",onClick:t.onSaveCombinedTag,disabled:t.selectedTagsForCombination.length<2},t.editingCombinedTag?"Save":"Create")))),t.showDeleteModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseDeleteModal},React.createElement("div",{class:"modal-content",onClick:n=>n.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Confirm Delete"),React.createElement("span",{class:"modal-close",onClick:t.onCloseDeleteModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("p",null,'Are you sure you want to delete combined tag "',React.createElement("strong",null,t.deletingCombinedTag&&t.deletingCombinedTag.name),'"?'),React.createElement("p",{class:"warning-text"},"This action is irreversible.")),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseDeleteModal},"Cancel"),React.createElement("button",{class:"btn btn-danger",onClick:t.onConfirmDelete},"Delete")))))};class re extends React.Component{constructor(e){super(e),this.state={combined_tags:e.combined_tags,tags:e.tags,showAddEditModal:!1,showDeleteModal:!1,editingCombinedTag:null,deletingCombinedTag:null,selectedTagsForCombination:[],combinationDropdownOpen:!1,combinationSearchValue:""},this.handleAddCombinedTag=this.handleAddCombinedTag.bind(this),this.handleEditCombinedTag=this.handleEditCombinedTag.bind(this),this.handleDeleteCombinedTag=this.handleDeleteCombinedTag.bind(this),this.handleCloseAddEditModal=this.handleCloseAddEditModal.bind(this),this.handleCloseDeleteModal=this.handleCloseDeleteModal.bind(this),this.handleSaveCombinedTag=this.handleSaveCombinedTag.bind(this),this.handleConfirmDelete=this.handleConfirmDelete.bind(this),this.handleToggleCombinationDropdown=this.handleToggleCombinationDropdown.bind(this),this.handleCombinationTagToggle=this.handleCombinationTagToggle.bind(this),this.handleRemoveCombinationTag=this.handleRemoveCombinationTag.bind(this),this.handleCombinationSearchChange=this.handleCombinationSearchChange.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}componentDidMount(){document.addEventListener("mousedown",this.handleClickOutside),document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("mousedown",this.handleClickOutside),document.removeEventListener("keydown",this.handleKeyDown)}handleKeyDown(e){e.key==="Escape"&&(this.state.showAddEditModal&&this.handleCloseAddEditModal(),this.state.showDeleteModal&&this.handleCloseDeleteModal(),this.state.combinationDropdownOpen&&this.setState({combinationDropdownOpen:!1}))}handleClickOutside(e){const a=document.getElementById("combination-dropdown");a&&!a.contains(e.target)&&this.setState({combinationDropdownOpen:!1})}handleAddCombinedTag(){this.setState({showAddEditModal:!0,editingCombinedTag:null,selectedTagsForCombination:[],combinationSearchValue:""})}handleEditCombinedTag(e){const a=e.name.split(",").map(n=>n.trim()).filter(n=>n.length>0);this.setState({showAddEditModal:!0,editingCombinedTag:e,selectedTagsForCombination:a,combinationSearchValue:""})}handleDeleteCombinedTag(e){this.setState({showDeleteModal:!0,deletingCombinedTag:e})}handleCloseAddEditModal(){this.setState({showAddEditModal:!1,editingCombinedTag:null,selectedTagsForCombination:[],combinationDropdownOpen:!1,combinationSearchValue:""})}handleCloseDeleteModal(){this.setState({showDeleteModal:!1,deletingCombinedTag:null})}handleSaveCombinedTag(){const{editingCombinedTag:e,selectedTagsForCombination:a}=this.state;if(a.length<2){alert("Please select at least two tags to combine");return}const n=a.join(", ");if(e){if(e.name===n){this.handleCloseAddEditModal();return}r("/rename_ctag/"+encodeURIComponent(e.name)+"/"+encodeURIComponent(n)).then(o=>o.text()).then(o=>{if(o.includes("ok"))this.setState(d=>{const i=Ce(d.combined_tags,e.name,n);return w(i,{renderCombined:!1}),{combined_tags:i,showAddEditModal:!1,editingCombinedTag:null,selectedTagsForCombination:[],combinationDropdownOpen:!1,combinationSearchValue:""}}),console.log("Combined tag edited successfully");else throw new Error("Rename failed: "+o)}).catch(o=>{console.error("Error editing combined tag:",o),alert("Edit failed: "+o.message)})}else r("/add_ctag/"+encodeURIComponent(n)).then(o=>o.text()).then(o=>{o.includes("ok")?(this.setState(d=>{const i=d.combined_tags.concat([{name:n}]);return w(i,{renderCombined:!1}),{combined_tags:i,showAddEditModal:!1,selectedTagsForCombination:[],combinationDropdownOpen:!1,combinationSearchValue:""}}),console.log("Combined tag added successfully")):alert("Add failed: "+o)}).catch(o=>{console.error("Error adding combined tag:",o),alert("Network error, add failed")})}handleConfirmDelete(){const{deletingCombinedTag:e}=this.state;r("/del_ctag/"+encodeURIComponent(e.name)).then(a=>a.text()).then(a=>{a.includes("ok")?(this.setState(n=>{const o=n.combined_tags.filter(d=>d.name!==e.name);return w(o,{renderCombined:!1}),{combined_tags:o,showDeleteModal:!1,deletingCombinedTag:null}}),console.log("Combined tag deleted successfully")):alert("Delete failed: "+a)}).catch(a=>{console.error("Error deleting combined tag:",a),alert("Network error, delete failed")})}handleToggleCombinationDropdown(){this.setState(e=>({combinationDropdownOpen:!e.combinationDropdownOpen,combinationSearchValue:e.combinationDropdownOpen?e.combinationSearchValue:""}))}handleCombinationTagToggle(e){this.setState(a=>({selectedTagsForCombination:a.selectedTagsForCombination.includes(e)?a.selectedTagsForCombination.filter(o=>o!==e):[...a.selectedTagsForCombination,e]}))}handleRemoveCombinationTag(e){this.setState(a=>({selectedTagsForCombination:a.selectedTagsForCombination.filter(n=>n!==e)}))}handleCombinationSearchChange(e){this.setState({combinationSearchValue:e.target.value})}render(){const e=this.state.tags.filter(a=>a.name!=="all").map(a=>a.name);return React.createElement(le,{combined_tags:this.state.combined_tags,onAddCombinedTag:this.handleAddCombinedTag,onEditCombinedTag:this.handleEditCombinedTag,onDeleteCombinedTag:this.handleDeleteCombinedTag,showAddEditModal:this.state.showAddEditModal,showDeleteModal:this.state.showDeleteModal,editingCombinedTag:this.state.editingCombinedTag,deletingCombinedTag:this.state.deletingCombinedTag,onCloseAddEditModal:this.handleCloseAddEditModal,onCloseDeleteModal:this.handleCloseDeleteModal,onSaveCombinedTag:this.handleSaveCombinedTag,onConfirmDelete:this.handleConfirmDelete,selectedTagsForCombination:this.state.selectedTagsForCombination,availableTagsForCombination:e,combinationDropdownOpen:this.state.combinationDropdownOpen,onToggleCombinationDropdown:this.handleToggleCombinationDropdown,onCombinationTagToggle:this.handleCombinationTagToggle,onRemoveCombinationTag:this.handleRemoveCombinationTag,combinationSearchValue:this.state.combinationSearchValue,onCombinationSearchChange:this.handleCombinationSearchChange})}}const ce=t=>{const e=t.jkey,a=Q(e.name),n="rel_ukey"+(e.name==="Artificial general intelligence"?" rel_ukey_all":""),o=e.name!=="Artificial general intelligence";return React.createElement("div",{class:n+" enhanced-keyword"},React.createElement("a",{href:a,class:"keyword-link"},e.name),o&&React.createElement("div",{class:"keyword-actions"},React.createElement("span",{class:"keyword-edit",onClick:()=>t.onEdit(e),title:"Edit keyword"},"\u270E"),React.createElement("span",{class:"keyword-delete",onClick:()=>t.onDelete(e),title:"Delete keyword"},"\xD7")))},he=t=>{const e=t.keys,a=e.map((n,o)=>React.createElement(ce,{key:o,jkey:n,onEdit:t.onEditKey,onDelete:t.onDeleteKey}));return React.createElement("div",{class:"enhanced-keyword-list"},React.createElement("div",{class:"keyword-list-actions"},React.createElement("span",{class:"tag-stats-inline"},"(",e.length," keywords)"),React.createElement("button",{class:"tag-action-btn add-btn",onClick:t.onAddKey,title:"Add new keyword"},"+ Add")),React.createElement("div",{id:"keyList",class:"rel_utags enhanced-keywords"},a),t.showAddModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseAddModal},React.createElement("div",{class:"modal-content",onClick:n=>n.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Add Keyword"),React.createElement("span",{class:"modal-close",onClick:t.onCloseAddModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("div",{class:"form-group"},React.createElement("label",null,"Keyword Name:"),React.createElement("input",{type:"text",value:t.newKeyName,onChange:t.onNewKeyNameChange,class:"form-input",placeholder:"Enter keyword name"}))),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseAddModal},"Cancel"),React.createElement("button",{class:"btn btn-primary",onClick:t.onSaveNewKey},"Save")))),t.showEditModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseEditModal},React.createElement("div",{class:"modal-content",onClick:n=>n.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Edit Keyword"),React.createElement("span",{class:"modal-close",onClick:t.onCloseEditModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("div",{class:"form-group"},React.createElement("label",null,"Keyword Name:"),React.createElement("input",{type:"text",value:t.editingKeyName,onChange:t.onEditingKeyNameChange,class:"form-input",placeholder:"Enter new keyword name"}))),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseEditModal},"Cancel"),React.createElement("button",{class:"btn btn-primary",onClick:t.onSaveKeyEdit},"Save")))),t.showDeleteModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseDeleteModal},React.createElement("div",{class:"modal-content",onClick:n=>n.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Confirm Delete"),React.createElement("span",{class:"modal-close",onClick:t.onCloseDeleteModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("p",null,'Are you sure you want to delete keyword "',React.createElement("strong",null,t.deletingKey&&t.deletingKey.name),'"?'),React.createElement("p",{class:"warning-text"},"This action is irreversible, all data related to this keyword will be deleted.")),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseDeleteModal},"Cancel"),React.createElement("button",{class:"btn btn-danger",onClick:t.onConfirmDelete},"Delete")))))};class ge extends React.Component{constructor(e){super(e),this.state={keys:e.keys,showEditModal:!1,showDeleteModal:!1,showAddModal:!1,editingKey:null,editingKeyName:"",deletingKey:null,newKeyName:""},this.handleEditKey=this.handleEditKey.bind(this),this.handleDeleteKey=this.handleDeleteKey.bind(this),this.handleAddKey=this.handleAddKey.bind(this),this.handleCloseEditModal=this.handleCloseEditModal.bind(this),this.handleCloseDeleteModal=this.handleCloseDeleteModal.bind(this),this.handleCloseAddModal=this.handleCloseAddModal.bind(this),this.handleEditingKeyNameChange=this.handleEditingKeyNameChange.bind(this),this.handleNewKeyNameChange=this.handleNewKeyNameChange.bind(this),this.handleSaveKeyEdit=this.handleSaveKeyEdit.bind(this),this.handleSaveNewKey=this.handleSaveNewKey.bind(this),this.handleConfirmDelete=this.handleConfirmDelete.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}handleKeyDown(e){e.key==="Escape"&&(this.state.showEditModal&&this.handleCloseEditModal(),this.state.showDeleteModal&&this.handleCloseDeleteModal(),this.state.showAddModal&&this.handleCloseAddModal())}handleEditKey(e){this.setState({showEditModal:!0,editingKey:e,editingKeyName:e.name})}handleDeleteKey(e){this.setState({showDeleteModal:!0,deletingKey:e})}handleAddKey(){this.setState({showAddModal:!0,newKeyName:""})}handleCloseAddModal(){this.setState({showAddModal:!1,newKeyName:""})}handleNewKeyNameChange(e){this.setState({newKeyName:e.target.value})}handleSaveNewKey(){const{newKeyName:e}=this.state;if(!e.trim()){alert("Keyword name cannot be empty");return}const a=e.trim();if(this.state.keys.some(n=>n.name===a)){alert("Keyword already exists");return}r("/add_key/"+encodeURIComponent(a)).then(n=>n.text()).then(n=>{n.startsWith("ok")?(this.setState(o=>{const d=[...o.keys,{name:a,pids:[]}];return E(d,{renderKeys:!1}),{keys:d,showAddModal:!1,newKeyName:""}}),console.log("Keyword added successfully")):alert("Failed to add keyword: "+n)}).catch(n=>{console.error("Error adding keyword:",n),alert("Network error, failed to add keyword")})}handleCloseEditModal(){this.setState({showEditModal:!1,editingKey:null,editingKeyName:""})}handleCloseDeleteModal(){this.setState({showDeleteModal:!1,deletingKey:null})}handleEditingKeyNameChange(e){this.setState({editingKeyName:e.target.value})}handleSaveKeyEdit(){const{editingKey:e,editingKeyName:a}=this.state;if(!a.trim()){alert("Keyword name cannot be empty");return}const n=a.trim();if(this.state.keys.some(o=>o.name===n&&o.name!==e.name)){alert("Keyword already exists");return}r("/rename_key/"+encodeURIComponent(e.name)+"/"+encodeURIComponent(n)).then(o=>o.text()).then(o=>{o.startsWith("ok")?(this.setState(d=>{const i=d.keys.map(s=>s.name===e.name?C(u({},s),{name:n}):s);return E(i,{renderKeys:!1}),{keys:i,showEditModal:!1,editingKey:null,editingKeyName:""}}),console.log("Keyword renamed successfully")):alert("Rename failed: "+o)}).catch(o=>{console.error("Error renaming keyword:",o),alert("Rename failed: "+o.message)})}handleConfirmDelete(){const{deletingKey:e}=this.state;r("/del_key/"+encodeURIComponent(e.name)).then(a=>a.text()).then(a=>{a.startsWith("ok")?(this.setState(n=>{const o=n.keys.filter(d=>d.name!==e.name);return E(o,{renderKeys:!1}),{keys:o,showDeleteModal:!1,deletingKey:null}}),console.log("Keyword deleted successfully")):alert("Delete failed: "+a)}).catch(a=>{console.error("Error deleting keyword:",a),alert("Network error, delete failed")})}render(){return React.createElement(he,{keys:this.state.keys,onEditKey:this.handleEditKey,onDeleteKey:this.handleDeleteKey,onAddKey:this.handleAddKey,showEditModal:this.state.showEditModal,showDeleteModal:this.state.showDeleteModal,showAddModal:this.state.showAddModal,editingKeyName:this.state.editingKeyName,newKeyName:this.state.newKeyName,deletingKey:this.state.deletingKey,onCloseEditModal:this.handleCloseEditModal,onCloseDeleteModal:this.handleCloseDeleteModal,onCloseAddModal:this.handleCloseAddModal,onEditingKeyNameChange:this.handleEditingKeyNameChange,onNewKeyNameChange:this.handleNewKeyNameChange,onSaveKeyEdit:this.handleSaveKeyEdit,onSaveNewKey:this.handleSaveNewKey,onConfirmDelete:this.handleConfirmDelete})}}function T(t){const a=(t||[]).filter(n=>n&&n.name&&n.name!=="all").map(n=>({name:n.name,n:n.n}));return a.length>0&&a.push({name:"all"}),a.sort((n,o)=>n.name.localeCompare(o.name)),a}function m(t){const e=new Set,a=[];return(t||[]).forEach(n=>{const o=n&&n.name?n.name:"";!o||e.has(o)||(e.add(o),a.push({name:o}))}),a.sort((n,o)=>n.name.localeCompare(o.name)),a}function me(t,e,a){if(!e||!a)return m(t);const n=new Set,o=[];return(t||[]).forEach(d=>{const i=d&&d.name?d.name:"";if(!i)return;const s=i.split(",").map(g=>g.trim()).filter(Boolean);if(s.length===0)return;const c=(s.includes(e)?s.map(g=>g===e?a:g):s).join(", ");n.has(c)||(n.add(c),o.push({name:c}))}),o}function ue(t,e){if(!e)return m(t);const a=(t||[]).filter(n=>!(n&&n.name?n.name:"").split(",").map(i=>i.trim()).filter(Boolean).includes(e));return m(a)}function Ce(t,e,a){if(!e||!a)return m(t);const n=(t||[]).map(o=>o&&o.name===e?{name:a}:o);return m(n)}function f(t,e){const a=e||{};tags=T(t),a.renderTags!==!1&&F(),a.renderPaper!==!1&&L(),a.renderCombined!==!1&&D()}function w(t,e){const a=e||{};combined_tags=m(t),a.renderCombined!==!1&&D()}function E(t,e){const a=e||{};keys=Array.isArray(t)?t.slice():[],keys.sort((n,o)=>n.name.localeCompare(o.name)),a.renderKeys!==!1&&V()}function v(t,e){if(!t||t==="all"||!e)return;const a=(tags||[]).filter(s=>s&&s.name&&s.name!=="all");let n=!1,o=!1,d=!1;const i=a.map(s=>{if(s.name!==t)return s;n=!0;const h=s.n||0,c=Math.max(0,h+e);return h>0&&c===0&&(d=!0),C(u({},s),{n:c})});!n&&e>0&&(i.push({name:t,n:e}),o=!0),f(i,{renderPaper:o||d})}const A=document.getElementById("wrap"),N=document.getElementById("tagwrap"),_=document.getElementById("keywrap"),R=document.getElementById("tagcombwrap");function L(){A&&ReactDOM.render(React.createElement(ae,{papers,tags}),A)}function F(){N&&ReactDOM.render(React.createElement(ie,{tags}),N)}function V(){_&&ReactDOM.render(React.createElement(ge,{keys}),_)}function D(){R&&ReactDOM.render(React.createElement(re,{combined_tags,tags}),R)}L();F();V();D();})();
