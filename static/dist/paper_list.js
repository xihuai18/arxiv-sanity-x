"use strict";(()=>{var J=Object.defineProperty,G=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var A=(t,e,n)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,u=(t,e)=>{for(var n in e||(e={}))q.call(e,n)&&A(t,n,e[n]);if(K)for(var n of K(e))X.call(e,n)&&A(t,n,e[n]);return t},C=(t,e)=>G(t,H(e));function Q(){const t=document.querySelector('meta[name="csrf-token"]');return t&&t.getAttribute("content")||""}function r(t,e){const n=e||{},a=(n.method||"POST").toUpperCase(),o=new Headers(n.headers||{}),d=Q();return d&&o.set("X-CSRF-Token",d),fetch(t,C(u({},n),{method:a,headers:o,credentials:"same-origin"}))}function b(t,e,n){if(n==null)return;const a=String(n).trim();a&&t.set(e,a)}function L(t,e={}){typeof gvars=="undefined"||!gvars||(b(t,"time_filter",gvars.time_filter),gvars.skip_have&&t.set("skip_have",gvars.skip_have),e.includeLogic&&gvars.logic&&t.set("logic",gvars.logic),e.includeSvmC&&b(t,"svm_c",gvars.svm_c),e.includeSearchMode&&gvars.search_mode&&t.set("search_mode",gvars.search_mode),e.includeSemanticWeight&&b(t,"semantic_weight",gvars.semantic_weight))}function O(t,e={}){const n=new URLSearchParams;return n.set("rank","tags"),b(n,"tags",t),L(n,{includeLogic:!0,includeSvmC:!0}),e.logic&&n.set("logic",e.logic),"/?"+n.toString()}function Y(t){const e=new URLSearchParams;return e.set("rank","search"),b(e,"q",t),L(e,{includeSearchMode:!0,includeSemanticWeight:!0}),"/?"+e.toString()}const p=new Map;let N=!1;function Z(){N||(N=!0,document.addEventListener("mousedown",t=>{p.forEach((e,n)=>{if(!e.isOpen())return;const a=document.getElementById(n);a&&!a.contains(t.target)&&e.close()})}),document.addEventListener("keydown",t=>{t.key==="Escape"&&p.forEach(e=>{e.isOpen()&&e.close()})}))}function ee(t,e){p.set(t,e),Z()}function te(t){p.delete(t)}let M=null;function ne(){if(M)return M;if(typeof markdownit=="undefined")return null;const t=markdownit({html:!1,breaks:!0,linkify:!0}),e=t.renderer.rules.text||function(n,a){return n[a].content};return t.renderer.rules.text=function(n,a,o,d,i){let s=n[a].content;return s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),s},M=t,t}function ae(t){if(!t)return"";const e=ne();return e?e.render(t):t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}function oe(t){typeof MathJax!="undefined"&&MathJax.typesetPromise&&MathJax.typesetPromise(t?[t]:void 0).catch(function(e){console.warn("MathJax typeset error:",e)})}const F=t=>{const{selectedTags:e,availableTags:n,isOpen:a,onToggle:o,onTagToggle:d,onRemoveTag:i,newTagValue:s,onNewTagChange:h,onAddNewTag:c,dropdownId:g,searchValue:v,onSearchChange:S,showNewTagInput:W=!0}=t,B=e.map((l,k)=>React.createElement("div",{key:k,class:"multi-select-selected-tag"},React.createElement("span",null,l),React.createElement("span",{class:"remove-tag",onClick:()=>i(l)},"\xD7"))),j=e.length>0?React.createElement("div",{class:"multi-select-selected-tags"},B):React.createElement("div",{class:"multi-select-placeholder"},"Select tags..."),$=n.filter(l=>l.toLowerCase().includes(v.toLowerCase())).map((l,k)=>{const z=e.includes(l);return React.createElement("div",{key:k,class:"multi-select-option",onClick:()=>d(l)},React.createElement("input",{type:"checkbox",class:"multi-select-checkbox",checked:z,onChange:()=>{}}),React.createElement("span",{class:"multi-select-option-text"},l))});return React.createElement("div",{class:`multi-select-dropdown ${a?"open":""}`,id:g},React.createElement("div",{class:`multi-select-trigger ${a?"active":""}`,onClick:o},React.createElement("div",{class:"multi-select-content"},j),React.createElement("span",{class:"multi-select-arrow"},a?"\u25B2":"\u25BC")),a&&React.createElement("div",{class:"multi-select-dropdown-menu"},React.createElement("div",{class:"multi-select-search"},React.createElement("input",{type:"text",placeholder:"Search tags...",value:v,onChange:S,onClick:l=>l.stopPropagation()})),$,W&&React.createElement("div",{class:"multi-select-new-tag"},React.createElement("input",{type:"text",placeholder:"Enter new tag...",value:s,onChange:h,onKeyPress:l=>l.key==="Enter"&&c(),onClick:l=>l.stopPropagation()}),React.createElement("button",{onClick:c,disabled:!s.trim()},"Add"))))},de=t=>{const e=t.paper,a=t.tags.map((v,S)=>v.name),o=e.utags,d="/?rank=pid&pid="+encodeURIComponent(e.id),i="/inspect?pid="+encodeURIComponent(e.id),s="/summary?pid="+encodeURIComponent(e.id),h=e.thumb_url===""?null:React.createElement("div",{class:"rel_img"},React.createElement("img",{src:e.thumb_url}));let c=null;user&&(c=React.createElement("div",{class:"rel_utags"},React.createElement(F,{selectedTags:o,availableTags:a,isOpen:t.dropdownOpen,onToggle:t.onToggleDropdown,onTagToggle:t.onTagToggle,onRemoveTag:t.onRemoveTag,newTagValue:t.newTagValue,onNewTagChange:t.onNewTagChange,onAddNewTag:t.onAddNewTag,dropdownId:t.dropdownId,searchValue:t.searchValue,onSearchChange:t.onSearchChange})));const g=e.tldr?React.createElement("div",{class:"rel_tldr"},React.createElement("div",{class:"tldr_label"},"\u{1F4A1} TL;DR"),React.createElement("div",{class:"tldr_text",dangerouslySetInnerHTML:{__html:ae(e.tldr)}})):null;return React.createElement("div",{class:"rel_paper"},React.createElement("div",{class:"rel_score"},e.weight.toFixed(2),e.score_breakdown&&React.createElement("div",{class:"score_breakdown"},e.score_breakdown)),React.createElement("div",{class:"rel_title"},React.createElement("a",{href:"http://arxiv.org/abs/"+e.id,target:"_blank",rel:"noopener noreferrer"},e.title)),React.createElement("div",{class:"rel_authors"},e.authors),React.createElement("div",{class:"rel_time"},e.time),React.createElement("div",{class:"rel_tags"},e.tags),g,h,React.createElement("div",{class:"rel_abs"},e.summary),c,React.createElement("div",{class:"paper-actions-footer"},React.createElement("div",{class:"rel_more"},React.createElement("a",{href:d,target:"_blank",rel:"noopener noreferrer"},"Similar")),React.createElement("div",{class:"rel_inspect"},React.createElement("a",{href:i,target:"_blank",rel:"noopener noreferrer"},"Inspect")),React.createElement("div",{class:"rel_summary"},React.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},"Summary")),React.createElement("div",{class:"rel_alphaxiv"},React.createElement("a",{href:"https://www.alphaxiv.org/overview/"+e.id,target:"_blank",rel:"noopener noreferrer"},"alphaXiv")),React.createElement("div",{class:"rel_cool"},React.createElement("a",{href:"https://papers.cool/arxiv/"+e.id,target:"_blank",rel:"noopener noreferrer"},"Cool"))))},ie=t=>{const e=t.papers,n=t.tags.filter(o=>o.name!=="all"),a=e.map((o,d)=>React.createElement(se,{key:d,paper:o,tags:n}));return React.createElement("div",null,React.createElement("div",{id:"paperList",class:"rel_papers"},a))};class se extends React.Component{constructor(e){super(e),this.state={paper:e.paper,tags:e.tags,dropdownOpen:!1,newTagValue:"",searchValue:""},this.dropdownId="dropdown-"+e.paper.id,this.handleToggleDropdown=this.handleToggleDropdown.bind(this),this.handleTagToggle=this.handleTagToggle.bind(this),this.handleRemoveTag=this.handleRemoveTag.bind(this),this.handleNewTagChange=this.handleNewTagChange.bind(this),this.handleAddNewTag=this.handleAddNewTag.bind(this),this.handleSearchChange=this.handleSearchChange.bind(this)}componentDidMount(){ee(this.dropdownId,{isOpen:()=>this.state.dropdownOpen,close:()=>{const e=document.getElementById(this.dropdownId);if(e){const n=e.closest(".rel_paper");n&&n.classList.remove("dropdown-open")}this.setState({dropdownOpen:!1})}}),this.state.paper.tldr&&oe()}componentWillUnmount(){te(this.dropdownId)}handleToggleDropdown(){this.setState(e=>{const n=!e.dropdownOpen,a=document.getElementById(this.dropdownId);if(a){const o=a.closest(".rel_paper");o&&(n?o.classList.add("dropdown-open"):o.classList.remove("dropdown-open"))}return{dropdownOpen:n,searchValue:n?"":e.searchValue}})}handleSearchChange(e){this.setState({searchValue:e.target.value})}handleTagToggle(e){const{paper:n}=this.state;n.utags.includes(e)?r("/sub/"+n.id+"/"+encodeURIComponent(e)).then(o=>o.text()).then(o=>{o.startsWith("ok")?(n.utags=n.utags.filter(d=>d!==e),this.setState({paper:n}),f(e,-1),console.log(`Removed tag: ${e}`)):(console.error("Server error removing tag:",o),alert("Failed to remove tag: "+o))}).catch(o=>{console.error("Error removing tag:",o),alert("Network error, failed to remove tag")}):r("/add/"+n.id+"/"+encodeURIComponent(e)).then(o=>o.text()).then(o=>{o.startsWith("ok")?(n.utags.includes(e)||(n.utags=[...n.utags,e]),this.setState({paper:n}),f(e,1),console.log(`Added tag: ${e}`)):(console.error("Server error adding tag:",o),alert("Failed to add tag: "+o))}).catch(o=>{console.error("Error adding tag:",o),alert("Network error, failed to add tag")})}handleRemoveTag(e){const{paper:n}=this.state;r("/sub/"+n.id+"/"+encodeURIComponent(e)).then(a=>a.text()).then(a=>{a.startsWith("ok")?(n.utags=n.utags.filter(o=>o!==e),this.setState({paper:n}),f(e,-1),console.log(`Removed tag: ${e}`)):(console.error("Server error removing tag:",a),alert("Failed to remove tag: "+a))}).catch(a=>{console.error("Error removing tag:",a),alert("Network error, failed to remove tag")})}handleNewTagChange(e){this.setState({newTagValue:e.target.value})}handleAddNewTag(){const{paper:e,newTagValue:n}=this.state,a=n.trim();if(a){if(e.utags.includes(a)){alert("Tag already exists");return}r("/add/"+e.id+"/"+encodeURIComponent(a)).then(o=>o.text()).then(o=>{o.startsWith("ok")?(e.utags=[...e.utags,a],this.setState({paper:e,newTagValue:""}),f(a,1),console.log(`Added new tag: ${a}`)):(console.error("Server error adding new tag:",o),alert("Failed to add new tag: "+o))}).catch(o=>{console.error("Error adding new tag:",o),alert("Network error, failed to add new tag")})}}render(){return React.createElement(de,{paper:this.state.paper,tags:this.state.tags,dropdownOpen:this.state.dropdownOpen,onToggleDropdown:this.handleToggleDropdown,onTagToggle:this.handleTagToggle,onRemoveTag:this.handleRemoveTag,newTagValue:this.state.newTagValue,onNewTagChange:this.handleNewTagChange,onAddNewTag:this.handleAddNewTag,dropdownId:this.dropdownId,searchValue:this.state.searchValue,onSearchChange:this.handleSearchChange})}}const le=t=>{const e=t.tag,n=O(e.name),a="rel_utag"+(e.name==="all"?" rel_utag_all":""),o=e.name!=="all";return React.createElement("div",{class:a+" enhanced-tag"},React.createElement("a",{href:n,class:"tag-link"},e.n," ",e.name),o&&React.createElement("div",{class:"tag-actions"},React.createElement("span",{class:"tag-edit",onClick:()=>t.onEdit(e),title:"Edit tag"},"\u270E"),React.createElement("span",{class:"tag-delete",onClick:()=>t.onDelete(e),title:"Delete tag"},"\xD7")))},re=t=>{const e=t.tags,n=e.map((d,i)=>React.createElement(le,{key:i,tag:d,onEdit:t.onEditTag,onDelete:t.onDeleteTag})),a=()=>{const d=document.getElementById("wordwrap");d.style.display==="block"?d.style.display="none":d.style.display="block"},o=words.length>0?React.createElement("div",{id:"inspect_svm",onClick:a},"inspect"):null;return React.createElement("div",{class:"enhanced-tag-list"},React.createElement("div",{class:"tag-list-actions"},React.createElement("span",{class:"tag-stats-inline"},"(",e.length," tags)"),React.createElement("button",{class:"tag-action-btn add-btn",onClick:t.onAddTag,title:"Add new tag"},"+ Add")),React.createElement("div",{id:"tagList",class:"rel_utags enhanced-tags"},n),o,t.showEditModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseEditModal},React.createElement("div",{class:"modal-content",onClick:d=>d.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Edit Tag"),React.createElement("span",{class:"modal-close",onClick:t.onCloseEditModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("div",{class:"form-group"},React.createElement("label",null,"Tag Name:"),React.createElement("input",{type:"text",value:t.editingTagName,onChange:t.onEditingTagNameChange,class:"form-input",placeholder:"Enter new tag name"}))),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseEditModal},"Cancel"),React.createElement("button",{class:"btn btn-primary",onClick:t.onSaveTagEdit},"Save")))),t.showAddModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseAddModal},React.createElement("div",{class:"modal-content",onClick:d=>d.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Add Tag"),React.createElement("span",{class:"modal-close",onClick:t.onCloseAddModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("div",{class:"form-group"},React.createElement("label",null,"Tag Name:"),React.createElement("input",{type:"text",value:t.newTagName,onChange:t.onNewTagNameChange,class:"form-input",placeholder:"Enter tag name"}))),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseAddModal},"Cancel"),React.createElement("button",{class:"btn btn-primary",onClick:t.onSaveNewTag},"Save")))),t.showDeleteModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseDeleteModal},React.createElement("div",{class:"modal-content",onClick:d=>d.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Confirm Delete"),React.createElement("span",{class:"modal-close",onClick:t.onCloseDeleteModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("p",null,'Are you sure you want to delete tag "',React.createElement("strong",null,t.deletingTag&&t.deletingTag.name),'"?'),React.createElement("p",{class:"warning-text"},"This action is irreversible. All papers under this tag will lose the tag.")),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseDeleteModal},"Cancel"),React.createElement("button",{class:"btn btn-danger",onClick:t.onConfirmDelete},"Delete")))))};class ce extends React.Component{constructor(e){super(e),this.state={tags:e.tags,showEditModal:!1,showDeleteModal:!1,showAddModal:!1,editingTag:null,editingTagName:"",deletingTag:null,newTagName:""},this.handleEditTag=this.handleEditTag.bind(this),this.handleDeleteTag=this.handleDeleteTag.bind(this),this.handleAddTag=this.handleAddTag.bind(this),this.handleCloseEditModal=this.handleCloseEditModal.bind(this),this.handleCloseDeleteModal=this.handleCloseDeleteModal.bind(this),this.handleCloseAddModal=this.handleCloseAddModal.bind(this),this.handleEditingTagNameChange=this.handleEditingTagNameChange.bind(this),this.handleNewTagNameChange=this.handleNewTagNameChange.bind(this),this.handleSaveTagEdit=this.handleSaveTagEdit.bind(this),this.handleSaveNewTag=this.handleSaveNewTag.bind(this),this.handleConfirmDelete=this.handleConfirmDelete.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}handleKeyDown(e){e.key==="Escape"&&(this.state.showEditModal&&this.handleCloseEditModal(),this.state.showDeleteModal&&this.handleCloseDeleteModal(),this.state.showAddModal&&this.handleCloseAddModal())}handleEditTag(e){this.setState({showEditModal:!0,editingTag:e,editingTagName:e.name})}handleDeleteTag(e){this.setState({showDeleteModal:!0,deletingTag:e})}handleAddTag(){this.setState({showAddModal:!0,newTagName:""})}handleCloseAddModal(){this.setState({showAddModal:!1,newTagName:""})}handleNewTagNameChange(e){this.setState({newTagName:e.target.value})}handleSaveNewTag(){const{newTagName:e}=this.state,n=e.trim();if(!n){alert("Tag name cannot be empty");return}if(n==="all"||n==="null"){alert("Tag name is reserved");return}if(this.state.tags.some(a=>a.name===n)){alert("Tag already exists");return}r("/add_tag/"+encodeURIComponent(n)).then(a=>a.text()).then(a=>{a.startsWith("ok")?(this.setState(o=>{const d=T(o.tags.filter(i=>i.name!=="all").concat([{name:n,n:0}]));return y(d,{renderTags:!1}),{tags:d,showAddModal:!1,newTagName:""}}),console.log("Tag added successfully")):alert("Add failed: "+a)}).catch(a=>{console.error("Error adding tag:",a),alert("Network error, add failed")})}handleCloseEditModal(){this.setState({showEditModal:!1,editingTag:null,editingTagName:""})}handleCloseDeleteModal(){this.setState({showDeleteModal:!1,deletingTag:null})}handleEditingTagNameChange(e){this.setState({editingTagName:e.target.value})}handleSaveTagEdit(){const{editingTag:e,editingTagName:n}=this.state;if(!n.trim()){alert("Tag name cannot be empty");return}const a=n.trim();if(this.state.tags.some(o=>o.name===a&&o.name!==e.name)){alert("Tag already exists");return}r("/rename/"+encodeURIComponent(e.name)+"/"+encodeURIComponent(a)).then(o=>o.text()).then(o=>{o.startsWith("ok")?(this.setState(d=>{const i=T(d.tags.map(h=>h.name===e.name?C(u({},h),{name:a}):h)),s=we(combined_tags,e.name,a);return w(s,{renderCombined:!1}),y(i,{renderTags:!1}),{tags:i,showEditModal:!1,editingTag:null,editingTagName:""}}),console.log("Tag renamed successfully")):alert("Rename failed: "+o)}).catch(o=>{console.error("Error renaming tag:",o),alert("Network error, rename failed")})}handleConfirmDelete(){const{deletingTag:e}=this.state;r("/del/"+encodeURIComponent(e.name)).then(n=>n.text()).then(n=>{n.startsWith("ok")?(this.setState(a=>{const o=T(a.tags.filter(i=>i.name!==e.name)),d=ve(combined_tags,e.name);return w(d,{renderCombined:!1}),y(o,{renderTags:!1}),{tags:o,showDeleteModal:!1,deletingTag:null}}),console.log("Tag deleted successfully")):alert("Delete failed: "+n)}).catch(n=>{console.error("Error deleting tag:",n),alert("Network error, delete failed")})}render(){return React.createElement(re,{tags:this.state.tags,onEditTag:this.handleEditTag,onDeleteTag:this.handleDeleteTag,onAddTag:this.handleAddTag,showEditModal:this.state.showEditModal,showDeleteModal:this.state.showDeleteModal,showAddModal:this.state.showAddModal,editingTagName:this.state.editingTagName,newTagName:this.state.newTagName,deletingTag:this.state.deletingTag,onCloseEditModal:this.handleCloseEditModal,onCloseDeleteModal:this.handleCloseDeleteModal,onCloseAddModal:this.handleCloseAddModal,onEditingTagNameChange:this.handleEditingTagNameChange,onNewTagNameChange:this.handleNewTagNameChange,onSaveTagEdit:this.handleSaveTagEdit,onSaveNewTag:this.handleSaveNewTag,onConfirmDelete:this.handleConfirmDelete})}}const he=t=>{const e=t.comtag,n=O(e.name,{logic:"and"});return React.createElement("div",{class:"rel_utag rel_utag_all enhanced-combined-tag"},React.createElement("a",{href:n,class:"combined-tag-link"},e.name),React.createElement("div",{class:"combined-tag-actions"},React.createElement("span",{class:"combined-tag-edit",onClick:()=>t.onEdit(e),title:"Edit combined tag"},"\u270E"),React.createElement("span",{class:"combined-tag-delete",onClick:()=>t.onDelete(e),title:"Delete combined tag"},"\xD7")))},ge=t=>{const e=t.combined_tags,n=e.map((a,o)=>React.createElement(he,{key:o,comtag:a,onEdit:t.onEditCombinedTag,onDelete:t.onDeleteCombinedTag}));return React.createElement("div",{class:"enhanced-combined-tag-list"},React.createElement("div",{class:"combined-tag-list-actions"},React.createElement("span",{class:"tag-stats-inline"},"(",e.length," combined tags)"),React.createElement("button",{class:"tag-action-btn add-btn",onClick:t.onAddCombinedTag,title:"Add new combined tag"},"+ Add")),React.createElement("div",{id:"combinedTagList",class:"rel_utags enhanced-combined-tags"},n),t.showAddEditModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseAddEditModal},React.createElement("div",{class:"modal-content wide",onClick:a=>a.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,t.editingCombinedTag?"Edit Combined Tag":"Add Combined Tag"),React.createElement("span",{class:"modal-close",onClick:t.onCloseAddEditModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("div",{class:"form-group"},React.createElement("label",null,"Select tags to combine:"),React.createElement(F,{selectedTags:t.selectedTagsForCombination,availableTags:t.availableTagsForCombination,isOpen:t.combinationDropdownOpen,onToggle:t.onToggleCombinationDropdown,onTagToggle:t.onCombinationTagToggle,onRemoveTag:t.onRemoveCombinationTag,newTagValue:"",onNewTagChange:()=>{},onAddNewTag:()=>{},dropdownId:"combination-dropdown",searchValue:t.combinationSearchValue,onSearchChange:t.onCombinationSearchChange,showNewTagInput:!1})),t.selectedTagsForCombination.length>0&&React.createElement("div",{class:"tag-combination-preview"},React.createElement("h4",null,"Preview Combination:"),React.createElement("div",{class:"tag-combination-preview-tags"},t.selectedTagsForCombination.map((a,o)=>React.createElement("span",{key:o,class:"tag-combination-preview-tag"},a))),React.createElement("p",{style:{marginTop:"10px",fontSize:"12px",color:"var(--text-color)",opacity:"0.8"}},"Combination Name: ",t.selectedTagsForCombination.join(", ")))),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseAddEditModal},"Cancel"),React.createElement("button",{class:"btn btn-primary",onClick:t.onSaveCombinedTag,disabled:t.selectedTagsForCombination.length<2},t.editingCombinedTag?"Save":"Create")))),t.showDeleteModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseDeleteModal},React.createElement("div",{class:"modal-content",onClick:a=>a.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Confirm Delete"),React.createElement("span",{class:"modal-close",onClick:t.onCloseDeleteModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("p",null,'Are you sure you want to delete combined tag "',React.createElement("strong",null,t.deletingCombinedTag&&t.deletingCombinedTag.name),'"?'),React.createElement("p",{class:"warning-text"},"This action is irreversible.")),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseDeleteModal},"Cancel"),React.createElement("button",{class:"btn btn-danger",onClick:t.onConfirmDelete},"Delete")))))};class me extends React.Component{constructor(e){super(e),this.state={combined_tags:e.combined_tags,tags:e.tags,showAddEditModal:!1,showDeleteModal:!1,editingCombinedTag:null,deletingCombinedTag:null,selectedTagsForCombination:[],combinationDropdownOpen:!1,combinationSearchValue:""},this.handleAddCombinedTag=this.handleAddCombinedTag.bind(this),this.handleEditCombinedTag=this.handleEditCombinedTag.bind(this),this.handleDeleteCombinedTag=this.handleDeleteCombinedTag.bind(this),this.handleCloseAddEditModal=this.handleCloseAddEditModal.bind(this),this.handleCloseDeleteModal=this.handleCloseDeleteModal.bind(this),this.handleSaveCombinedTag=this.handleSaveCombinedTag.bind(this),this.handleConfirmDelete=this.handleConfirmDelete.bind(this),this.handleToggleCombinationDropdown=this.handleToggleCombinationDropdown.bind(this),this.handleCombinationTagToggle=this.handleCombinationTagToggle.bind(this),this.handleRemoveCombinationTag=this.handleRemoveCombinationTag.bind(this),this.handleCombinationSearchChange=this.handleCombinationSearchChange.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}componentDidMount(){document.addEventListener("mousedown",this.handleClickOutside),document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("mousedown",this.handleClickOutside),document.removeEventListener("keydown",this.handleKeyDown)}handleKeyDown(e){e.key==="Escape"&&(this.state.showAddEditModal&&this.handleCloseAddEditModal(),this.state.showDeleteModal&&this.handleCloseDeleteModal(),this.state.combinationDropdownOpen&&this.setState({combinationDropdownOpen:!1}))}handleClickOutside(e){const n=document.getElementById("combination-dropdown");n&&!n.contains(e.target)&&this.setState({combinationDropdownOpen:!1})}handleAddCombinedTag(){this.setState({showAddEditModal:!0,editingCombinedTag:null,selectedTagsForCombination:[],combinationSearchValue:""})}handleEditCombinedTag(e){const n=e.name.split(",").map(a=>a.trim()).filter(a=>a.length>0);this.setState({showAddEditModal:!0,editingCombinedTag:e,selectedTagsForCombination:n,combinationSearchValue:""})}handleDeleteCombinedTag(e){this.setState({showDeleteModal:!0,deletingCombinedTag:e})}handleCloseAddEditModal(){this.setState({showAddEditModal:!1,editingCombinedTag:null,selectedTagsForCombination:[],combinationDropdownOpen:!1,combinationSearchValue:""})}handleCloseDeleteModal(){this.setState({showDeleteModal:!1,deletingCombinedTag:null})}handleSaveCombinedTag(){const{editingCombinedTag:e,selectedTagsForCombination:n}=this.state;if(n.length<2){alert("Please select at least two tags to combine");return}const a=n.join(", ");if(e){if(e.name===a){this.handleCloseAddEditModal();return}r("/rename_ctag/"+encodeURIComponent(e.name)+"/"+encodeURIComponent(a)).then(o=>o.text()).then(o=>{if(o.includes("ok"))this.setState(d=>{const i=fe(d.combined_tags,e.name,a);return w(i,{renderCombined:!1}),{combined_tags:i,showAddEditModal:!1,editingCombinedTag:null,selectedTagsForCombination:[],combinationDropdownOpen:!1,combinationSearchValue:""}}),console.log("Combined tag edited successfully");else throw new Error("Rename failed: "+o)}).catch(o=>{console.error("Error editing combined tag:",o),alert("Edit failed: "+o.message)})}else r("/add_ctag/"+encodeURIComponent(a)).then(o=>o.text()).then(o=>{o.includes("ok")?(this.setState(d=>{const i=d.combined_tags.concat([{name:a}]);return w(i,{renderCombined:!1}),{combined_tags:i,showAddEditModal:!1,selectedTagsForCombination:[],combinationDropdownOpen:!1,combinationSearchValue:""}}),console.log("Combined tag added successfully")):alert("Add failed: "+o)}).catch(o=>{console.error("Error adding combined tag:",o),alert("Network error, add failed")})}handleConfirmDelete(){const{deletingCombinedTag:e}=this.state;r("/del_ctag/"+encodeURIComponent(e.name)).then(n=>n.text()).then(n=>{n.includes("ok")?(this.setState(a=>{const o=a.combined_tags.filter(d=>d.name!==e.name);return w(o,{renderCombined:!1}),{combined_tags:o,showDeleteModal:!1,deletingCombinedTag:null}}),console.log("Combined tag deleted successfully")):alert("Delete failed: "+n)}).catch(n=>{console.error("Error deleting combined tag:",n),alert("Network error, delete failed")})}handleToggleCombinationDropdown(){this.setState(e=>({combinationDropdownOpen:!e.combinationDropdownOpen,combinationSearchValue:e.combinationDropdownOpen?e.combinationSearchValue:""}))}handleCombinationTagToggle(e){this.setState(n=>({selectedTagsForCombination:n.selectedTagsForCombination.includes(e)?n.selectedTagsForCombination.filter(o=>o!==e):[...n.selectedTagsForCombination,e]}))}handleRemoveCombinationTag(e){this.setState(n=>({selectedTagsForCombination:n.selectedTagsForCombination.filter(a=>a!==e)}))}handleCombinationSearchChange(e){this.setState({combinationSearchValue:e.target.value})}render(){const e=this.state.tags.filter(n=>n.name!=="all").map(n=>n.name);return React.createElement(ge,{combined_tags:this.state.combined_tags,onAddCombinedTag:this.handleAddCombinedTag,onEditCombinedTag:this.handleEditCombinedTag,onDeleteCombinedTag:this.handleDeleteCombinedTag,showAddEditModal:this.state.showAddEditModal,showDeleteModal:this.state.showDeleteModal,editingCombinedTag:this.state.editingCombinedTag,deletingCombinedTag:this.state.deletingCombinedTag,onCloseAddEditModal:this.handleCloseAddEditModal,onCloseDeleteModal:this.handleCloseDeleteModal,onSaveCombinedTag:this.handleSaveCombinedTag,onConfirmDelete:this.handleConfirmDelete,selectedTagsForCombination:this.state.selectedTagsForCombination,availableTagsForCombination:e,combinationDropdownOpen:this.state.combinationDropdownOpen,onToggleCombinationDropdown:this.handleToggleCombinationDropdown,onCombinationTagToggle:this.handleCombinationTagToggle,onRemoveCombinationTag:this.handleRemoveCombinationTag,combinationSearchValue:this.state.combinationSearchValue,onCombinationSearchChange:this.handleCombinationSearchChange})}}const ue=t=>{const e=t.jkey,n=Y(e.name),a="rel_ukey"+(e.name==="Artificial general intelligence"?" rel_ukey_all":""),o=e.name!=="Artificial general intelligence";return React.createElement("div",{class:a+" enhanced-keyword"},React.createElement("a",{href:n,class:"keyword-link"},e.name),o&&React.createElement("div",{class:"keyword-actions"},React.createElement("span",{class:"keyword-edit",onClick:()=>t.onEdit(e),title:"Edit keyword"},"\u270E"),React.createElement("span",{class:"keyword-delete",onClick:()=>t.onDelete(e),title:"Delete keyword"},"\xD7")))},Ce=t=>{const e=t.keys,n=e.map((a,o)=>React.createElement(ue,{key:o,jkey:a,onEdit:t.onEditKey,onDelete:t.onDeleteKey}));return React.createElement("div",{class:"enhanced-keyword-list"},React.createElement("div",{class:"keyword-list-actions"},React.createElement("span",{class:"tag-stats-inline"},"(",e.length," keywords)"),React.createElement("button",{class:"tag-action-btn add-btn",onClick:t.onAddKey,title:"Add new keyword"},"+ Add")),React.createElement("div",{id:"keyList",class:"rel_utags enhanced-keywords"},n),t.showAddModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseAddModal},React.createElement("div",{class:"modal-content",onClick:a=>a.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Add Keyword"),React.createElement("span",{class:"modal-close",onClick:t.onCloseAddModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("div",{class:"form-group"},React.createElement("label",null,"Keyword Name:"),React.createElement("input",{type:"text",value:t.newKeyName,onChange:t.onNewKeyNameChange,class:"form-input",placeholder:"Enter keyword name"}))),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseAddModal},"Cancel"),React.createElement("button",{class:"btn btn-primary",onClick:t.onSaveNewKey},"Save")))),t.showEditModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseEditModal},React.createElement("div",{class:"modal-content",onClick:a=>a.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Edit Keyword"),React.createElement("span",{class:"modal-close",onClick:t.onCloseEditModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("div",{class:"form-group"},React.createElement("label",null,"Keyword Name:"),React.createElement("input",{type:"text",value:t.editingKeyName,onChange:t.onEditingKeyNameChange,class:"form-input",placeholder:"Enter new keyword name"}))),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseEditModal},"Cancel"),React.createElement("button",{class:"btn btn-primary",onClick:t.onSaveKeyEdit},"Save")))),t.showDeleteModal&&React.createElement("div",{class:"modal-overlay",onClick:t.onCloseDeleteModal},React.createElement("div",{class:"modal-content",onClick:a=>a.stopPropagation()},React.createElement("div",{class:"modal-header"},React.createElement("h3",null,"Confirm Delete"),React.createElement("span",{class:"modal-close",onClick:t.onCloseDeleteModal},"\xD7")),React.createElement("div",{class:"modal-body"},React.createElement("p",null,'Are you sure you want to delete keyword "',React.createElement("strong",null,t.deletingKey&&t.deletingKey.name),'"?'),React.createElement("p",{class:"warning-text"},"This action is irreversible, all data related to this keyword will be deleted.")),React.createElement("div",{class:"modal-footer"},React.createElement("button",{class:"btn btn-cancel",onClick:t.onCloseDeleteModal},"Cancel"),React.createElement("button",{class:"btn btn-danger",onClick:t.onConfirmDelete},"Delete")))))};class be extends React.Component{constructor(e){super(e),this.state={keys:e.keys,showEditModal:!1,showDeleteModal:!1,showAddModal:!1,editingKey:null,editingKeyName:"",deletingKey:null,newKeyName:""},this.handleEditKey=this.handleEditKey.bind(this),this.handleDeleteKey=this.handleDeleteKey.bind(this),this.handleAddKey=this.handleAddKey.bind(this),this.handleCloseEditModal=this.handleCloseEditModal.bind(this),this.handleCloseDeleteModal=this.handleCloseDeleteModal.bind(this),this.handleCloseAddModal=this.handleCloseAddModal.bind(this),this.handleEditingKeyNameChange=this.handleEditingKeyNameChange.bind(this),this.handleNewKeyNameChange=this.handleNewKeyNameChange.bind(this),this.handleSaveKeyEdit=this.handleSaveKeyEdit.bind(this),this.handleSaveNewKey=this.handleSaveNewKey.bind(this),this.handleConfirmDelete=this.handleConfirmDelete.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}handleKeyDown(e){e.key==="Escape"&&(this.state.showEditModal&&this.handleCloseEditModal(),this.state.showDeleteModal&&this.handleCloseDeleteModal(),this.state.showAddModal&&this.handleCloseAddModal())}handleEditKey(e){this.setState({showEditModal:!0,editingKey:e,editingKeyName:e.name})}handleDeleteKey(e){this.setState({showDeleteModal:!0,deletingKey:e})}handleAddKey(){this.setState({showAddModal:!0,newKeyName:""})}handleCloseAddModal(){this.setState({showAddModal:!1,newKeyName:""})}handleNewKeyNameChange(e){this.setState({newKeyName:e.target.value})}handleSaveNewKey(){const{newKeyName:e}=this.state;if(!e.trim()){alert("Keyword name cannot be empty");return}const n=e.trim();if(this.state.keys.some(a=>a.name===n)){alert("Keyword already exists");return}r("/add_key/"+encodeURIComponent(n)).then(a=>a.text()).then(a=>{a.startsWith("ok")?(this.setState(o=>{const d=[...o.keys,{name:n,pids:[]}];return E(d,{renderKeys:!1}),{keys:d,showAddModal:!1,newKeyName:""}}),console.log("Keyword added successfully")):alert("Failed to add keyword: "+a)}).catch(a=>{console.error("Error adding keyword:",a),alert("Network error, failed to add keyword")})}handleCloseEditModal(){this.setState({showEditModal:!1,editingKey:null,editingKeyName:""})}handleCloseDeleteModal(){this.setState({showDeleteModal:!1,deletingKey:null})}handleEditingKeyNameChange(e){this.setState({editingKeyName:e.target.value})}handleSaveKeyEdit(){const{editingKey:e,editingKeyName:n}=this.state;if(!n.trim()){alert("Keyword name cannot be empty");return}const a=n.trim();if(this.state.keys.some(o=>o.name===a&&o.name!==e.name)){alert("Keyword already exists");return}r("/rename_key/"+encodeURIComponent(e.name)+"/"+encodeURIComponent(a)).then(o=>o.text()).then(o=>{o.startsWith("ok")?(this.setState(d=>{const i=d.keys.map(s=>s.name===e.name?C(u({},s),{name:a}):s);return E(i,{renderKeys:!1}),{keys:i,showEditModal:!1,editingKey:null,editingKeyName:""}}),console.log("Keyword renamed successfully")):alert("Rename failed: "+o)}).catch(o=>{console.error("Error renaming keyword:",o),alert("Rename failed: "+o.message)})}handleConfirmDelete(){const{deletingKey:e}=this.state;r("/del_key/"+encodeURIComponent(e.name)).then(n=>n.text()).then(n=>{n.startsWith("ok")?(this.setState(a=>{const o=a.keys.filter(d=>d.name!==e.name);return E(o,{renderKeys:!1}),{keys:o,showDeleteModal:!1,deletingKey:null}}),console.log("Keyword deleted successfully")):alert("Delete failed: "+n)}).catch(n=>{console.error("Error deleting keyword:",n),alert("Network error, delete failed")})}render(){return React.createElement(Ce,{keys:this.state.keys,onEditKey:this.handleEditKey,onDeleteKey:this.handleDeleteKey,onAddKey:this.handleAddKey,showEditModal:this.state.showEditModal,showDeleteModal:this.state.showDeleteModal,showAddModal:this.state.showAddModal,editingKeyName:this.state.editingKeyName,newKeyName:this.state.newKeyName,deletingKey:this.state.deletingKey,onCloseEditModal:this.handleCloseEditModal,onCloseDeleteModal:this.handleCloseDeleteModal,onCloseAddModal:this.handleCloseAddModal,onEditingKeyNameChange:this.handleEditingKeyNameChange,onNewKeyNameChange:this.handleNewKeyNameChange,onSaveKeyEdit:this.handleSaveKeyEdit,onSaveNewKey:this.handleSaveNewKey,onConfirmDelete:this.handleConfirmDelete})}}function T(t){const n=(t||[]).filter(a=>a&&a.name&&a.name!=="all").map(a=>({name:a.name,n:a.n}));return n.length>0&&n.push({name:"all"}),n.sort((a,o)=>a.name.localeCompare(o.name)),n}function m(t){const e=new Set,n=[];return(t||[]).forEach(a=>{const o=a&&a.name?a.name:"";!o||e.has(o)||(e.add(o),n.push({name:o}))}),n.sort((a,o)=>a.name.localeCompare(o.name)),n}function we(t,e,n){if(!e||!n)return m(t);const a=new Set,o=[];return(t||[]).forEach(d=>{const i=d&&d.name?d.name:"";if(!i)return;const s=i.split(",").map(g=>g.trim()).filter(Boolean);if(s.length===0)return;const c=(s.includes(e)?s.map(g=>g===e?n:g):s).join(", ");a.has(c)||(a.add(c),o.push({name:c}))}),o}function ve(t,e){if(!e)return m(t);const n=(t||[]).filter(a=>!(a&&a.name?a.name:"").split(",").map(i=>i.trim()).filter(Boolean).includes(e));return m(n)}function fe(t,e,n){if(!e||!n)return m(t);const a=(t||[]).map(o=>o&&o.name===e?{name:n}:o);return m(a)}function y(t,e){const n=e||{};tags=T(t),n.renderTags!==!1&&U(),n.renderPaper!==!1&&V(),n.renderCombined!==!1&&D()}function w(t,e){const n=e||{};combined_tags=m(t),n.renderCombined!==!1&&D()}function E(t,e){const n=e||{};keys=Array.isArray(t)?t.slice():[],keys.sort((a,o)=>a.name.localeCompare(o.name)),n.renderKeys!==!1&&P()}function f(t,e){if(!t||t==="all"||!e)return;const n=(tags||[]).filter(s=>s&&s.name&&s.name!=="all");let a=!1,o=!1,d=!1;const i=n.map(s=>{if(s.name!==t)return s;a=!0;const h=s.n||0,c=Math.max(0,h+e);return h>0&&c===0&&(d=!0),C(u({},s),{n:c})});!a&&e>0&&(i.push({name:t,n:e}),o=!0),y(i,{renderPaper:o||d})}const _=document.getElementById("wrap"),R=document.getElementById("tagwrap"),x=document.getElementById("keywrap"),I=document.getElementById("tagcombwrap");function V(){_&&ReactDOM.render(React.createElement(ie,{papers,tags}),_)}function U(){R&&ReactDOM.render(React.createElement(ce,{tags}),R)}function P(){x&&ReactDOM.render(React.createElement(be,{keys}),x)}function D(){I&&ReactDOM.render(React.createElement(me,{combined_tags,tags}),I)}V();U();P();D();})();
