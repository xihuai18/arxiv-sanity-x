"use strict";(()=>{(function(){if(typeof window=="undefined")return;var S=window.ArxivSanityCommon,k=S.csrfFetch,E=S.registerDropdown,R=S.unregisterDropdown;const b=u=>{const{selectedTags:p,negativeTags:o,availableTags:d,isOpen:c,onToggle:T,onTagCycle:w,onClearTag:e,newTagValue:r,onNewTagChange:v,onAddNewTag:f,dropdownId:h,searchValue:i,onSearchChange:V,showNewTagInput:t=!0}=u,a=n=>(p||[]).includes(n)?1:(o||[]).includes(n)?-1:0,l=[...(p||[]).map(n=>({tag:n,state:1})),...(o||[]).map(n=>({tag:n,state:-1}))].map((n,C)=>React.createElement("div",{key:`${n.tag}-${n.state}-${C}`,class:`multi-select-selected-tag ${n.state===-1?"tag-negative":"tag-positive"}`,title:"Click to cycle: Unlabeled \u2192 Positive \u2192 Negative \u2192 Unlabeled"},React.createElement("span",{class:"tag-state-icon"},n.state===1?"+":"\u2212"),React.createElement("span",null,n.tag),React.createElement("span",{class:"remove-tag",onClick:m=>{m.stopPropagation(),e(n.tag)}},"\xD7"))),s=(p||[]).length>0||(o||[]).length>0?React.createElement("div",{class:"multi-select-selected-tags"},l):React.createElement("div",{class:"multi-select-placeholder"},"Select tags..."),N=(d||[]).filter(n=>String(n||"").toLowerCase().includes(String(i||"").toLowerCase())).map((n,C)=>{const m=a(n),A=m===1?"tag-state-positive":m===-1?"tag-state-negative":"tag-state-neutral";return React.createElement("div",{key:C,class:`multi-select-option ${A}`,onClick:()=>w(n),title:"Click to cycle: Unlabeled \u2192 Positive \u2192 Negative \u2192 Unlabeled"},React.createElement("span",{class:`tag-state-badge ${A}`},m===1?"+":m===-1?"\u2212":""),React.createElement("span",{class:"multi-select-option-text"},n))});return React.createElement("div",{class:`multi-select-dropdown ${c?"open":""}`,id:h},React.createElement("div",{class:`multi-select-trigger ${c?"active":""}`,onClick:T,title:"Click to cycle: Unlabeled \u2192 Positive \u2192 Negative \u2192 Unlabeled"},React.createElement("div",{class:"multi-select-content"},s),React.createElement("span",{class:"multi-select-arrow"},c?"\u25B2":"\u25BC")),c?React.createElement("div",{class:"multi-select-dropdown-menu"},React.createElement("div",{class:"multi-select-search"},React.createElement("input",{type:"text",placeholder:"Search tags...",value:i,onChange:V,onClick:n=>n.stopPropagation()})),N,t?React.createElement("div",{class:"multi-select-new-tag"},React.createElement("input",{type:"text",placeholder:"Enter new tag...",value:r,onChange:v,onKeyPress:n=>{n.key==="Enter"&&f()},onClick:n=>n.stopPropagation()}),React.createElement("button",{onClick:f,disabled:!String(r||"").trim()},"Add")):null):null)};function y(u){const p=(Array.isArray(u)?u:[]).map(c=>String(c||"").trim()).filter(Boolean),o=new Set,d=[];return p.forEach(c=>{o.has(c)||(o.add(c),d.push(c))}),d.sort((c,T)=>c.localeCompare(T)),d}function D(u,p){const o=p||{},d=typeof u=="string"?document.getElementById(u):u;if(!d)throw new Error("Tag dropdown mount target not found");if(typeof React=="undefined"||typeof ReactDOM=="undefined")throw new Error("React/ReactDOM not loaded");const c=String(o.pid||"").trim(),T=typeof o.onStateChange=="function"?o.onStateChange:null,w=o.dropdownId||"tag-dropdown-"+Math.random().toString(36).slice(2),e={selectedTags:Array.isArray(o.selectedTags)?o.selectedTags.slice():[],negativeTags:Array.isArray(o.negativeTags)?o.negativeTags.slice():[],availableTags:y(o.availableTags||[]),open:!!o.open,searchValue:String(o.searchValue||""),newTagValue:String(o.newTagValue||"")};function r(){T&&T({selectedTags:e.selectedTags.slice(),negativeTags:e.negativeTags.slice(),availableTags:e.availableTags.slice(),open:!!e.open,searchValue:String(e.searchValue||""),newTagValue:String(e.newTagValue||"")})}function v(t){const a=String(t||"").trim();a&&(e.availableTags.includes(a)||(e.availableTags=y(e.availableTags.concat([a]))))}function f(t,a){const l=String(t||"").trim();if(!l)return;const g=new Set(e.selectedTags),s=new Set(e.negativeTags);a===1?(g.add(l),s.delete(l)):a===-1?(g.delete(l),s.add(l)):(g.delete(l),s.delete(l)),e.selectedTags=Array.from(g),e.negativeTags=Array.from(s),r()}async function h(t,a){if(!c)throw new Error("pid is required for tag dropdown");const l=String(t||"").trim(),s=await(await k("/api/tag_feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pid:c,tag:l,label:a})})).json().catch(()=>null);if(!s||!s.success)throw new Error(s&&s.error?s.error:"Failed to update tag");v(l),f(l,a)}function i(){ReactDOM.render(React.createElement(b,{selectedTags:e.selectedTags,negativeTags:e.negativeTags,availableTags:e.availableTags,isOpen:e.open,onToggle:()=>{e.open=!e.open,e.open||(e.searchValue="",e.newTagValue=""),i(),r()},onTagCycle:t=>{const a=e.selectedTags.includes(t),l=e.negativeTags.includes(t);h(t,a?-1:l?0:1).catch(s=>{console.error("Failed to update tag feedback:",s),alert("Failed to update tag feedback: "+(s&&s.message?s.message:String(s)))})},onClearTag:t=>{h(t,0).catch(a=>{console.error("Failed to clear tag:",a),alert("Failed to clear tag: "+(a&&a.message?a.message:String(a)))})},newTagValue:e.newTagValue,onNewTagChange:t=>{e.newTagValue=t&&t.target?t.target.value:"",i(),r()},onAddNewTag:()=>{const t=String(e.newTagValue||"").trim();t&&h(t,1).then(()=>{e.newTagValue="",i(),r()}).catch(a=>{console.error("Failed to add new tag:",a),alert("Failed to add new tag: "+(a&&a.message?a.message:String(a)))})},dropdownId:w,searchValue:e.searchValue,onSearchChange:t=>{e.searchValue=t&&t.target?t.target.value:"",i(),r()}}),d)}return E(w,{isOpen:()=>!!e.open,close:()=>{e.open&&(e.open=!1,e.searchValue="",e.newTagValue="",i(),r())}}),i(),r(),{getUiState:()=>({open:!!e.open,searchValue:String(e.searchValue||""),newTagValue:String(e.newTagValue||"")}),updateAvailableTags:t=>{e.availableTags=y(t||[]),i(),r()},applyTagFeedback:(t,a)=>{v(t),f(String(t||""),Number(a)),i()},applyTagRename:(t,a)=>{const l=String(t||"").trim(),g=String(a||"").trim();!l||!g||(e.selectedTags=e.selectedTags.map(s=>s===l?g:s),e.negativeTags=e.negativeTags.map(s=>s===l?g:s),v(g),i(),r())},applyTagDelete:t=>{const a=String(t||"").trim();a&&(e.selectedTags=e.selectedTags.filter(l=>l!==a),e.negativeTags=e.negativeTags.filter(l=>l!==a),i(),r())},unmount:()=>{try{ReactDOM.unmountComponentAtNode(d)}catch(t){}R(w)}}}window.ArxivSanityTagDropdown={mount:D,MultiSelectDropdown:b,_registerDropdown:E,_unregisterDropdown:R}})();})();
