{% extends "base.html" %}

{% block head_extra %}
<!-- React + shared tag dropdown (for consistent 3-state tag UI across pages) -->
<script defer src="{{ url_for('static', filename='lib/react.production.min.js') }}"></script>
<script defer src="{{ url_for('static', filename='lib/react-dom.production.min.js') }}"></script>
<script defer src="{{ hashed_static('dist/tag_dropdown_shared.js') }}"></script>
<script defer src="{{ hashed_static('dist/author_utils.js') }}"></script>
<script defer src="{{ url_for('static', filename='lib/markdown-it.min.js') }}"></script>
<script defer src="{{ hashed_static('dist/markdown_sanitizer_utils.js') }}"></script>
<script defer src="{{ hashed_static('dist/markdown_renderer_utils.js') }}"></script>
<script defer src="{{ hashed_static('dist/markdown_core_utils.js') }}"></script>
<script defer src="{{ hashed_static('dist/tldr_utils.js') }}"></script>

<script>
var MJX_FONT_URL = {{ url_for('static', filename='lib/es5/output/chtml/fonts/woff-v2') | tojson }};
{% raw %}
// MathJax config only; actual MathJax script is loaded on-demand by CommonUtils.triggerMathJax().
window.MathJax = {
    loader: { load: ['[tex]/boldsymbol', '[tex]/mathtools', '[tex]/physics', '[tex]/tagformat'] },
    tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']],
        processEscapes: true,
        processEnvironments: true,
        packages: { '[+]': ['base', 'ams', 'boldsymbol', 'braket', 'cancel', 'color', 'enclose', 'mathtools', 'newcommand', 'noerrors', 'noundefined', 'physics', 'tagformat', 'textmacros', 'unicode', 'verb'] },
        tags: 'ams',
        macros: {
            bm: ['\\mathbf{#1}', 1],
            boldsymbol: ['\\mathbf{#1}', 1],
            RR: '\\mathbb{R}',
            NN: '\\mathbb{N}',
            ZZ: '\\mathbb{Z}',
            EE: '\\mathbb{E}',
            abs: ['\\left|#1\\right|', 1],
            norm: ['\\left\\|#1\\right\\|', 1],
            argmax: '\\operatorname*{arg\\,max}',
            argmin: '\\operatorname*{arg\\,min}',
            // Text in math mode - use math variants for compatibility
            textit: ['\\mathit{#1}', 1],
            textbf: ['\\mathbf{#1}', 1],
            textrm: ['\\mathrm{#1}', 1],
            textsf: ['\\mathsf{#1}', 1],
            texttt: ['\\mathtt{#1}', 1],
            // Common spacing (note: do NOT redefine \mid as it's a standard LaTeX relation symbol)
            given: '\\\\,|\\\\,'
        }
    },
    options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'], ignoreHtmlClass: 'tex2jax_ignore', processHtmlClass: 'tex2jax_process' },
    chtml: { scale: 1.0, displayAlign: 'center', fontURL: MJX_FONT_URL }
};
{% endraw %}
</script>
{% endblock %}

{% block variables %}
<script>
var papers = {{ papers | tojson }};
var tags = {{ tags | tojson }};
var defaultSummaryModel = {{ default_summary_model | tojson }};
</script>
{% endblock %}

{% block elements %}
<script defer src="{{ hashed_static('dist/readinglist.js') }}"></script>
{% endblock %}

{% block content %}
<div class="rl-container">
    <div class="rl-header">
        <h1>ðŸ“– Reading List</h1>
        <p>Papers you want to read later.</p>
    </div>

    {% if message %}
    <div class="rl-login-message">
        <p>{{ message }}</p>
        <p><a href="/profile">Log in</a> to start using reading list.</p>
    </div>
    {% else %}
    <div id="rl-papers"></div>

    <div id="rl-empty-state">
        <h3>No papers in reading list</h3>
        <p>Add papers from the main page by clicking the bookmark icon.</p>
    </div>

    <!-- Uploaded Papers Section -->
    <div class="rl-section-divider"></div>
    <div class="rl-header rl-uploaded-header">
        <h2>ðŸ“¤ Uploaded Papers</h2>
        <p>Your private uploaded PDFs.</p>
    </div>

    <div class="rl-upload-area" id="upload-area">
        <input type="file" id="pdf-upload-input" accept=".pdf" style="display: none;">
        <button type="button" class="upload-btn" id="upload-btn">
            <span class="upload-icon">ðŸ“„</span>
            <span>Upload PDF</span>
        </button>
        <div class="upload-progress" id="upload-progress" style="display: none;">
            <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
            <span class="progress-text" id="progress-text">Uploading...</span>
        </div>
    </div>

    <div id="uploaded-papers"></div>

    <div id="uploaded-empty-state">
        <h3>No uploaded papers</h3>
        <p>Upload a PDF to get started. Your papers are private and only visible to you.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
